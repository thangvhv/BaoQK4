<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <title>Chợ nhà mình</title>
    <style>
	body {
		-webkit-touch-callout: none;
		-webkit-text-size-adjust: none;
		-webkit-user-select: none;
		height:100%;
		margin:0px;
		padding:0px;
		width:100%;
	}
	</style>
</head>
<body>
<img id="welcome-image" src="img/welcome.png" width="100%">
<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript">
var app = {
    initialize: function() {
        document.addEventListener('deviceready', this.onDeviceReady, false);
    },
    onDeviceReady: function() {
		if(localStorage.getItem('registrationId'))
		{
			app.initFrame();
		}
		else
		{
			app.setupPush();
		}
    },
    setupPush: function() {
		try{
			var push = PushNotification.init({
				"android": {
					"senderID": "239167227311"
				},
				"browser": {
					
				},
				"ios": {
					"sound": true,
					"vibration": true,
					"badge": true,
					"clearBadge": true
				},
				"windows": {}
			});
			
			push.on('registration', function(data) {
				if (app.oldRegId !== data.registrationId) {
					app.setDeviceId(data.registrationId);
				}
			});
	
		}
		catch(e)
		{
			alert(e.getMessage());
		}
    },
	initFrame: function()
	{
		app.oldRegId = localStorage.getItem('registrationId');
		location.replace('https://chonhaminh.coquan.vn/?page=Mobile.home&androidRegistrationId='+(app.oldRegId?app.oldRegId:'mobile')+'&platform=' + cordova.platformId);
	},
	setDeviceId: function(deviceId)
	{
		localStorage.setItem('registrationId', deviceId);
		setTimeout(function(){
			app.initFrame();
		}, 100);
	}
};
app.initialize();
</script>
</body>

</html>
