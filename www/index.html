<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <title>VCNet</title>
    <style>
	body {
		-webkit-touch-callout: none;
		-webkit-text-size-adjust: none;
		-webkit-user-select: none;
		height:100%;
		margin:0px;
		padding:0px;
		width:100%;
	}
	</style>
</head>

<body>
<img id="welcome-image" src="img/welcome.png" width="100%">
<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript">
var app = {
    initialize: function() {
        this.bindEvents();
    },
    bindEvents: function() {
		
        document.addEventListener('deviceready', this.onDeviceReady, false);
    },
    onDeviceReady: function() {
		//app.initFrame();
        app.setupPush();
    },
    setupPush: function() {
		try{
			var push = PushNotification.init({
				"android": {
					"senderID": "127284230534"
				},
				"browser": {
					
				},
				"ios": {
					"sound": true,
					"vibration": true,
					"badge": true,
					"clearBadge": true
				},
				"windows": {}
			});
			
			push.on('registration', function(data) {
				if (app.oldRegId !== data.registrationId) {
					app.setDeviceId(data.registrationId);
				}
			});
	
			push.on('error', function(e) {
				alert("push error = " + e.message);
				//app.initFrame('');
			});
	
			push.on('notification', function(data) {
				//alert('notification event');
				app.win.executeScript({
					code: 'VHV.app.onNotify('+JSON.stringify(data)+');'
				});
				//alert(data.message);
				if(0) navigator.notification.alert(
					data.message,         // message
					null,                 // callback
					data.title,           // title
					'Ok'                  // buttonName
				);
		   });
		}
		catch(e)
		{
			alert(e.getMessage());
		}
    },
	initFrame: function()
	{
		app.oldRegId = localStorage.getItem('registrationId');
		window.open = cordova.InAppBrowser.open;
		try{
			document.getElementById('welcome-image').style.display = 'none';
			if(app.win){
				if(app.oldRegId != 'mobile' && app.oldRegId != 'web' && app.oldRegId != 'BLACKLISTED')
				{
					setTimeout(function(){
						app.win.addEventListener('loadstop', function() {
							app.win.executeScript({code: "VHV.Model('Member.Device.log')({androidRegistrationId:'"+app.oldRegId+"'});"});
						});
					}, 5000);
				}
			}
			else
			{
				location = 'https://vcnetlocal.coquan.vn/?page=Mobile.login&androidRegistrationId='+(app.oldRegId?app.oldRegId:'mobile');
				/*app.win = cordova.InAppBrowser.open('https://vcnet.coquan.vn/?page=Mobile.login&androidRegistrationId='+(app.oldRegId?app.oldRegId:'mobile'), '_blank', 'fullscreen=yes,location=no,zoom=no,status=no,toolbar=no,titlebar=no,disallowoverscroll=yes,hidespinner=yes,clearcache=no,clearsessioncache=no');
				app.win.show();
				app.win.addEventListener('message', function (e) {
					alert(JSON.stringify(e.data));
					if(e.data.action === 'hide'){
						app.win.hide();
					}
				});*/
			}
		}
		catch(e)
		{
			alert(e.getMessage());
		}
	},
	setDeviceId: function(deviceId)
	{
		localStorage.setItem('registrationId', deviceId);
		setTimeout(function(){
			app.initFrame();
		}, 100);
	}
};
app.initialize();
</script>
</body>

</html>
